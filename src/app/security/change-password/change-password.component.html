<div class="container">
  <div class="row mt-3 mb-5 justify-content-center">
    <div class="col-md-5 col-lg-4">
      <div class="change-pass-card">
        <form [formGroup]="formChangePassword" (ngSubmit)="doSubmit()" novalidate>
         <h2 class="text-center mt-4 mb-4 change-title">Đổi mật khẩu</h2>
          <div class="mb-3">
            <label>Tên đăng nhập</label>
            <input class="form-control" [value]="username" readonly />
          </div>

          <div class="mb-3">
            <label>Mật khẩu <span class="text-danger">(*)</span></label>
            <input type="password" class="form-control" formControlName="password"
                   [class.is-invalid]="(form.password.touched || isSubmit) && form.password.invalid" />
            @if (form.password.errors?.['required']) {
              <div class="invalid-feedback">Mật khẩu không được để trống.</div>
            }
          </div>

          <fieldset formGroupName="passwordGroup">
            <div class="mb-3">
              <label>Mật khẩu mới <span class="text-danger">(*)</span></label>
              <input type="password" class="form-control" formControlName="newPassword"
                     [class.is-invalid]="(newPassword.touched || isSubmit) && (newPassword.invalid || formChangePassword.errors?.['sameAsOldPassword'])" />
              @if (newPassword.errors?.['required']) {
                <div class="invalid-feedback">Mật khẩu mới không được để trống.</div>
              } @else if (newPassword.errors?.['pattern']) {
                <div class="invalid-feedback">Mật khẩu phải có số, chữ hoa, chữ thường, ký tự đặc biệt (6–15 ký tự).</div>
              } @else if (formChangePassword.errors?.['sameAsOldPassword']) {
                <div class="invalid-feedback">Mật khẩu mới không được trùng với mật khẩu cũ.</div>
              }
            </div>

            <div class="mb-3">
              <label>Xác nhận mật khẩu <span class="text-danger">(*)</span></label>
              <input type="password" class="form-control" formControlName="confirmPassword"
                     [class.is-invalid]="(confirmPassword.touched || isSubmit) && (confirmPassword.invalid || form.passwordGroup.errors?.['passwordMismatch'])" />
              @if (confirmPassword.errors?.['required']) {
                <div class="invalid-feedback">Nhập lại mật khẩu không được để trống.</div>
              } @else if (form.passwordGroup.errors?.['passwordMismatch']) {
                <div class="invalid-feedback">Mật khẩu xác nhận không khớp.</div>
              }
            </div>
          </fieldset>

          <div class="d-flex justify-content-center gap-2 mt-3">
            <button type="button" class="btn btn-outline-secondary" (click)="cancel()">Huỷ</button>
            <button type="submit" class="btn btn-warning text-white">Cập nhật</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
